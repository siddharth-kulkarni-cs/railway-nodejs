<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Product Showcase - Explore our innovative products">
    <meta name="author" content="Siddharth Kulkarni">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Product Showcase</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
      :root {
        --primary-color: #4a6fa5;
        --secondary-color: #6e9887;
        --accent-color: #ffc107;
        --light-bg: #f8f9fa;
        --dark-text: #333;
        --card-bg: #ffffff;
        --border-color: rgba(0,0,0,0.1);
        --text-muted: #666;
        --shadow-color: rgba(0,0,0,0.1);
      }

      [data-theme="dark"] {
        --primary-color: #6b8cc4;
        --secondary-color: #8ab4a1;
        --accent-color: #ffd54f;
        --light-bg: #1a1a1a;
        --dark-text: #e0e0e0;
        --card-bg: #2d2d2d;
        --border-color: rgba(255,255,255,0.1);
        --text-muted: #b0b0b0;
        --shadow-color: rgba(0,0,0,0.3);
      }
      
      body {
        font-family: 'Roboto', sans-serif;
        background-color: var(--light-bg);
        color: var(--dark-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .site-header {
        background-color: var(--card-bg);
        box-shadow: 0 2px 10px var(--shadow-color);
        padding: 1rem 0;
        margin-bottom: 2rem;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }
      
      .site-title {
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 0;
      }
      
      .navbar-custom {
        background-color: var(--card-bg);
        padding: 0.5rem 1rem;
      }

      .theme-toggle {
        background: none;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 1rem;
      }

      .theme-toggle:hover {
        background-color: var(--primary-color);
        color: var(--card-bg);
      }

      .theme-toggle:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.3);
      }
      
      .navbar-custom .nav-link {
        color: var(--primary-color);
        font-weight: 500;
        margin: 0 0.5rem;
        transition: color 0.3s ease;
        display: flex;
        align-items: center;
      }
      
      .navbar-custom .nav-link:hover {
        color: var(--secondary-color);
      }
      
      .navbar-custom .nav-link .badge {
        margin-left: 0.25rem;
        font-size: 0.55rem;
        padding: 2px 4px;
      }
      
      .main-banner {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 4rem 0;
        margin-bottom: 3rem;
        text-align: center;
      }
      
      .search-card {
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--shadow-color);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: transform 0.2s ease, background-color 0.3s ease, box-shadow 0.3s ease;
      }
      
      .search-card:hover {
        transform: translateY(-5px);
      }
      
      .search-btn {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      
      .search-btn:hover {
        background-color: #3a5a80;
        border-color: #3a5a80;
      }
      
      .feature-box {
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        height: 100%;
        box-shadow: 0 4px 6px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
      }
      
      .feature-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px var(--shadow-color);
      }
      
      .feature-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }
      
      .feature-title {
        color: var(--secondary-color);
        font-weight: 600;
      }
      
      .btn-feature {
        background-color: var(--primary-color);
        color: white;
        margin-top: 1rem;
        transition: background-color 0.3s ease;
      }
      
      .btn-feature:hover {
        background-color: var(--secondary-color);
        color: white;
      }
      
      .product-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 6px 15px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        height: 100%;
        overflow: hidden;
        position: relative;
      }
      
      .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px var(--shadow-color);
      }
      
      .product-img {
        height: 180px;
        background-size: cover;
        background-position: center;
        position: relative;
      }
      
      .product-img::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40%;
        background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
      }
      
      .product-icon {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--accent-color);
        color: var(--dark-text);
        font-size: 1.8rem;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        z-index: 10;
      }
      
      .product-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: var(--primary-color);
        color: white;
        font-size: 0.8rem;
        padding: 5px 10px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        z-index: 10;
      }
      
      .product-body {
        padding: 1.8rem;
      }
      
      .product-title {
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 0.8rem;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
      }
      
      .product-title .icon {
        margin-right: 10px;
        color: var(--accent-color);
      }
      
      .product-description {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }
      
      footer {
        background-color: var(--card-bg);
        padding: 1.5rem 0;
        margin-top: auto;
        box-shadow: 0 -2px 10px var(--shadow-color);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      .card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .custom-file-label {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--dark-text);
      }

      .form-control {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--dark-text);
      }

      .form-control:focus {
        background-color: var(--card-bg);
        border-color: var(--primary-color);
        color: var(--dark-text);
      }

      code {
        background-color: var(--light-bg);
        color: var(--dark-text);
        border: 1px solid var(--border-color);
      }
      
      /* Visual File Map Styles */
      #visualMapCanvas {
        position: relative;
        min-height: 600px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 8px;
        overflow: hidden;
      }
      
      [data-theme="dark"] #visualMapCanvas {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      }
      
      #visualMapCanvas canvas {
        display: block;
        margin: 0 auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      .visual-map-controls {
        margin-top: 1rem;
        padding: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 2px 6px var(--shadow-color);
      }
      
      #vmNodeDetails {
        animation: fadeIn 0.3s ease-in-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      
      .new-feature-badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(238, 90, 36, 0.3);
        animation: pulse 2s infinite;
        z-index: 10;
      }
      
      /* Tech News Styles */
      .news-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      
      .news-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px var(--shadow-color);
        border-color: var(--primary-color);
      }
      
      .news-card-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 1rem;
      }
      
      .news-card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--primary-color);
        margin: 0;
        flex: 1;
        line-height: 1.4;
      }
      
      .news-card-title a {
        color: var(--primary-color);
        text-decoration: none;
        transition: color 0.2s ease;
      }
      
      .news-card-title a:hover {
        color: var(--secondary-color);
        text-decoration: underline;
      }
      
      .news-card-domain {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
      }
      
      .news-card-domain i {
        margin-right: 0.25rem;
        font-size: 0.75rem;
      }
      
      .news-card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
        font-size: 0.85rem;
        color: var(--text-muted);
      }
      
      .news-card-score {
        display: inline-flex;
        align-items: center;
        background-color: var(--light-bg);
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-weight: 600;
        color: var(--primary-color);
      }
      
      .news-card-score i {
        margin-right: 0.25rem;
        font-size: 0.75rem;
      }
      
      .news-card-comments {
        display: inline-flex;
        align-items: center;
        color: var(--text-muted);
      }
      
      .news-card-comments i {
        margin-right: 0.25rem;
        font-size: 0.75rem;
      }
      
      .news-card-author {
        color: var(--text-muted);
      }
      
      #refreshNewsBtn {
        transition: transform 0.3s ease;
      }
      
      #refreshNewsBtn:active {
        transform: rotate(180deg);
      }
      
      #refreshNewsBtn.loading {
        pointer-events: none;
        opacity: 0.6;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light navbar-custom">
          <a class="navbar-brand" href="/">
            <h1 class="site-title">Product Showcase</h1>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="/">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#products">Products</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#featured">Featured</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#file-sha">File Analysis</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/animations">Animations</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/dev-tools">Dev&nbsp;Tools <span class="badge badge-danger ml-1" style="font-size: 0.6em;">NEW</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/network-tools">Network&nbsp;Tools <span class="badge badge-danger ml-1" style="font-size: 0.6em;">NEW</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/reverse-geocode-demo">Reverse Geocode <span class="badge badge-danger ml-1" style="font-size: 0.6em;">NEW</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/stickies">üìù Sticky Notes <span class="badge badge-success ml-1" style="font-size: 0.6em;">NEW</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#about">About</a>
              </li>
              <li class="nav-item">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                  <i class="fas fa-moon" id="themeIcon"></i>
                </button>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    
    <div class="main-banner">
      <div class="container">
        <h2 class="display-4">Innovative Products and Services</h2>
        <p class="lead">Explore our collection of cutting-edge tools and applications</p>
      </div>
    </div>
    <!-- Tech News Section -->
    <section id="tech-news" class="mb-5">
      <h2 class="text-center mb-4">
        <i class="fas fa-newspaper mr-2"></i>Latest Technology News & Articles
        <span class="badge badge-danger ml-2" style="font-size: 0.5em; vertical-align: middle;">NEW</span>
      </h2>
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="search-card">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-rss fa-2x text-primary mr-3"></i>
              <h3 class="mb-0">Stay Updated with Tech</h3>
              <button id="refreshNewsBtn" class="btn btn-sm btn-outline-primary ml-auto" title="Refresh news">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
            
            <!-- Loading State -->
            <div id="newsLoading" class="text-center py-4" style="display: none;">
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
              <p class="mt-2 text-muted">Fetching latest tech news...</p>
            </div>
            
            <!-- Error State -->
            <div id="newsError" class="alert alert-warning" style="display: none;">
              <i class="fas fa-exclamation-triangle mr-2"></i>
              <span id="newsErrorText">Failed to load news. Please try again later.</span>
            </div>
            
            <!-- News Container -->
            <div id="newsContainer" class="row">
              <!-- News items will be inserted here dynamically -->
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <main class="container">
      <section id="featured" class="mb-5">
        <h2 class="text-center mb-4">Featured Product</h2>
        <section id="joke-generator" class="mb-5">
          <h2 class="text-center mb-5">
            AI Joke Generator 
            <span class="badge badge-danger ml-2" style="font-size: 0.5em; vertical-align: middle; animation: pulse 2s infinite;">NEW</span>
          </h2>
                     <div class="row justify-content-center">
             <div class="col-md-8">
               <div class="search-card" style="position: relative; overflow: visible;">
                 <span class="new-feature-badge">
                   <i class="fas fa-sparkles mr-1"></i>NEW
                 </span>
                 <div class="d-flex align-items-center mb-3">
                   <i class="fas fa-laugh-beam fa-2x text-warning mr-3"></i>
                   <h2 class="mb-0">Get a Joke on Any Topic!</h2>
                </div>
                <p class="lead mb-4">Our AI comedian is ready to make you laugh. Just tell us what you want a joke about!</p>
                <form id="jokeForm">
                  <div class="input-group mb-3">
                    <input type="text" id="jokeTopic" name="topic" class="form-control form-control-lg" placeholder="Enter a topic (e.g., programming, cats, coffee...)" required>
                    <div class="input-group-append">
                      <button class="btn btn-primary search-btn" type="submit" id="getJokeBtn">
                        <i class="fas fa-magic mr-2"></i>Get Joke
                      </button>
                    </div>
                  </div>
                </form>
                
                <div id="jokeLoading" class="text-center mt-3" style="display: none;">
                  <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <p class="mt-2 text-muted">Our AI comedian is thinking of something funny...</p>
                </div>
                
                <div id="jokeResult" class="mt-4" style="display: none;">
                  <div class="card">
                    <div class="card-header bg-warning text-dark">
                      <h5 class="mb-0">
                        <i class="fas fa-smile-wink mr-2"></i>Here's Your Joke!
                      </h5>
                    </div>
                    <div class="card-body">
                      <div id="jokeContent" style="font-size: 1.2rem; line-height: 1.8; color: var(--dark-text);">
                        <!-- Joke will be displayed here -->
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="mt-3">
                  <small class="text-muted">
                    <i class="fas fa-brain mr-1"></i>
                    Powered by advanced AI language models for creative and contextual humor.  The Jokes are generated by AI and although enough care has been taken to not generate any offensive jokes, in case it does, apologies in advance.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </section>
                  <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="search-card">
                <div class="d-flex align-items-center mb-3">
                  <i class="fas fa-book-open fa-2x text-warning mr-3"></i>
                  <h2 class="mb-0">Word Explorer</h2>
              </div>
              <p class="lead mb-4">Our powerful dictionary and language tool</p>
              <form action="/word-usage" method="get">
                <div class="input-group mb-3">
                  <input type="text" name="word" class="form-control form-control-lg" placeholder="Enter a word..." required>
                  <div class="input-group-append">
                    <button class="btn btn-primary search-btn" type="submit">Search</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
      
      <section id="file-sha" class="mb-5">
        <h2 class="text-center mb-4">File Hash Calculator & Metadata Extractor</h2>
        <div class="row justify-content-center">
          <div class="col-md-10">
            <div class="search-card">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-fingerprint fa-2x text-primary mr-3"></i>
                <h2 class="mb-0">Professional File Forensics Tool</h2>
              </div>
              <p class="lead mb-4">Professional-grade file analysis with forensic capabilities: SHA hashes, hex viewer, entropy visualization, string extraction, advanced file carving & embedded object extraction, polyglot detection, steganography analysis, and more. All processing happens in your browser for maximum privacy and security.</p>
              
              <div class="custom-file mb-3">
                <input type="file" class="custom-file-input" id="shaFileInput" accept="*/*">
                <label class="custom-file-label" for="shaFileInput">Choose file...</label>
              </div>
              
              <div class="mb-3">
                <small class="text-muted">Selected file: <span id="selectedFileName" class="font-weight-bold">No file selected</span></small>
                <br>
                <small class="text-info"><i class="fas fa-info-circle mr-1"></i>Maximum file size: 100 MB</small>
              </div>
              
              <button id="calculateShaBtn" class="btn btn-primary btn-lg btn-block" disabled>
                <i class="fas fa-microscope mr-2"></i>Perform Advanced Forensic Analysis
              </button>
              
              <button id="fileCarvingBtn" class="btn btn-danger btn-lg btn-block mt-2" disabled>
                <i class="fas fa-search-plus mr-2"></i>Advanced File Carving & Embedded Object Extraction
              </button>
              
              <button id="visualFileMapBtn" class="btn btn-warning btn-lg btn-block mt-2" disabled>
                <i class="fas fa-project-diagram mr-2"></i>Interactive Visual File Structure Map (NEW!)
              </button>
              
              <div id="shaLoading" class="text-center mt-3" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                  <span class="sr-only">Processing...</span>
                </div>
                <p class="mt-2 text-muted">Performing forensic analysis and extracting metadata...</p>
              </div>
              
              <div id="shaResult" class="mt-4" style="display: none;">
                <!-- File Metadata Card -->
                <div class="card mb-3">
                  <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                      <i class="fas fa-info-circle mr-2"></i>File Metadata
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>File Name:</strong> <span id="metaFileName"></span></p>
                        <p><strong>File Size:</strong> <span id="metaFileSize"></span></p>
                        <p><strong>File Type:</strong> <span id="metaFileType"></span></p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Extension:</strong> <span id="metaFileExtension"></span></p>
                        <p><strong>Last Modified:</strong> <span id="metaLastModified"></span></p>
                        <div id="imageMetadata" style="display: none;">
                          <p><strong>Dimensions:</strong> <span id="imageDimensions"></span></p>
                          <p><strong>Aspect Ratio:</strong> <span id="imageAspectRatio"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Hash Results Card -->
                <div class="card">
                  <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                      <i class="fas fa-check-circle mr-2"></i>Hash Values
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-1:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha1Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha1Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-256:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha256Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha256Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-384:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha384Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha384Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-512:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha512Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha512Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                  </div>
                </div>

                <!-- Enhanced Metadata Result -->
                <div id="enhancedMetadataResult" class="mt-4"></div>

                <!-- Advanced Analysis Result -->
                <div id="advancedAnalysisResult" class="mt-4"></div>

                 <!-- Byte Pattern Analysis Card -->
               <div id="bytePatternAnalysisCard" class="card mt-4" style="display: none;">
                 <div class="card-header bg-secondary text-white">
                   <h5 class="mb-0">
                     <i class="fas fa-chart-bar mr-2"></i>Byte Pattern Analysis
                   </h5>
                 </div>
                 <div class="card-body">
                   <!-- Shannon Entropy Display -->
                   <div class="mb-3">
                     <h6>Shannon Entropy</h6>
                     <p id="entropyDisplay" class="lead" style="font-size: 1.1rem;">Not yet calculated.</p>
                     <small id="entropyInterpretation" class="text-muted">Measures the randomness/uncertainty of data. Ranges from 0 (no uncertainty) to 8.0 (maximum uncertainty for byte data). High values often indicate compressed or encrypted data. Low values suggest redundancy, like plain text or structured binary data.</small>
                   </div>
                   <hr>
                   <!-- Byte Frequency Chart -->
                   <div class="mb-3">
                     <h6>Byte Frequency Distribution (0-255)</h6>
                     <div class="mb-1 d-flex justify-content-around flex-wrap">
                         <small><span style="color: #28a745;">‚ñ†</span> Printable ASCII (0x20-0x7E)</small>
                         <small><span style="color: #fd7e14;">‚ñ†</span> Control Chars (0x00-0x1F, 0x7F)</small>
                         <small><span style="color: #007bff;">‚ñ†</span> Extended/Binary (0x80-0xFF)</small>
                     </div>
                     <canvas id="byteFrequencyChartCanvas" width="400" height="200"></canvas>
                     <small class="text-muted">Shows frequency of each byte value. Colors indicate byte type (see legend). Helps identify data patterns, compression, or encryption.</small>
                   </div>
                   <hr>
                   <!-- N-gram Analysis -->
                   <div>
                     <h6>N-gram Analysis (Common Byte Sequences)</h6>
                     <div class="form-row align-items-center mb-2">
                       <div class="col-auto">
                         <label for="ngramNValue" class="col-form-label">N-gram length (N):</label>
                       </div>
                       <div class="col-auto">
                         <input type="number" class="form-control form-control-sm" id="ngramNValue" value="2" min="1" max="5">
                       </div>
                       <div class="col-auto">
                         <button id="analyzeNGramsBtn" class="btn btn-sm btn-info">Analyze N-grams</button>
                       </div>
                     </div>
                     <div id="ngramResultsTableContainer" style="max-height: 300px; overflow-y: auto;">
                       <!-- N-gram table will be rendered here by JavaScript -->
                     </div>
                     <small class="text-muted">Shows the most frequent sequences of N bytes (N-grams). This can help identify file type signatures (magic numbers), repeated data structures, common opcodes in executables, or typical patterns in text or structured binary data.</small>
                   </div>
                 </div>
               </div>

              </div>
              
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-shield-alt mr-1"></i>
                  Your file is processed entirely in your browser (max 100 MB). No data is sent to our servers.
                </small>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      
      <section id="products" class="mb-5">
        <h2 class="text-center mb-4">Our Products</h2>
        <div class="row">
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?dictionary')">
                <div class="product-icon">
                  <i class="fas fa-book-open"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-book"></i>
                  Word Explorer
                </h3>
                <p class="product-description">A comprehensive dictionary tool with AI-powered etymology and usage examples.</p>
                <a href="#featured" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?animation')">
                <div class="product-icon">
                  <i class="fas fa-magic"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-palette"></i>
                  Animation Gallery
                </h3>
                <p class="product-description">Interactive animations powered by P5.js. Experience particles, waves, fireworks and more.</p>
                <a href="/animations" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?security')">
                <div class="product-icon">
                  <i class="fas fa-fingerprint"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-shield-alt"></i>
                  File Analysis Tool
                </h3>
                <p class="product-description">Professional forensic analysis with hex viewer, entropy visualization, string extraction, file carving, steganography detection, and cryptographic analysis. Calculate multiple SHA hashes securely in your browser.</p>
                <a href="#file-sha" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?comedy,laugh')">
                <div class="product-icon">
                  <i class="fas fa-laugh-beam"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-smile-wink"></i>
                  Joke Generator
                </h3>
                <p class="product-description">Get AI-powered jokes on any topic. Powered by advanced language models for hilarious results.</p>
                <a href="#joke-generator" class="btn btn-feature" data-track="Feature Button Clicked" data-track-feature="joke-generator">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <section id="about" class="mb-5">
        <div class="card">
          <div class="card-body">
            <h2 class="card-title">
              <i class="fas fa-info-circle text-primary mr-2"></i>
              About Our Platform
            </h2>
            <p class="card-text">We create innovative tools and applications to help people communicate more effectively. Our products leverage cutting-edge technology to deliver powerful, user-friendly experiences.</p>
            <p class="card-text">Our platform is designed to be fast, intuitive, and accessible, making technology work for everyone.</p>
          </div>
        </div>
      </section>
    </main>
  
    <div class="container text-center" style="margin-top: 2rem;">
      <span class="text-muted">This Platform is Powered by <a href="https://www.contentstack.com/launch" target="_blank">ContentStack Launch</a></span>
    </div>
    
    <footer>
      <div class="container text-center">
        <span class="text-muted">Siddharth Kulkarni ¬© 2025. All rights reserved.</span>
      </div>
    </footer>
    
    <!-- Mixpanel Analytics -->
    <script type="text/javascript">
    (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;for(void 0!==c?a=b[c]=[]:c="mixpanel",a.people=a.people||[],a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d},a.people.toString=function(){return a.toString(1)+".people (stub)"},i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" "),h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script src="/javascript/file-sha.js"></script>
    <script src="/javascript/file-sha-enhanced.js"></script>
    <script src="/javascript/advanced-analysis.js"></script>
    <script src="/javascript/file-carving-engine.js"></script>
    <script src="/javascript/file-carving-ui.js"></script>
    <script src="/javascript/byte-pattern-analyzer.js"></script>
    <script src="/javascript/visual-file-map.js"></script>
    
    <!-- Mixpanel Configuration -->
    <script>
      // You can override these values by setting them before loading mixpanel-config.js
      window.MIXPANEL_TOKEN = 'YOUR_MIXPANEL_TOKEN_HERE'; // Replace with your actual token
      window.MIXPANEL_ENABLED = true; // Set to false to disable tracking
    </script>
    <script src="/javascript/mixpanel-config.js"></script>
    
    <script>
      // Theme toggle functionality
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const htmlElement = document.documentElement;

      // Check for saved theme preference or default to 'light'
      const currentTheme = localStorage.getItem('theme') || 'light';
      htmlElement.setAttribute('data-theme', currentTheme);
      updateThemeIcon(currentTheme);
      updateNavbarTheme(currentTheme);

      themeToggle.addEventListener('click', () => {
        const currentTheme = htmlElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        // Track theme toggle
        window.trackEvent('Theme Toggled', {
          previous_theme: currentTheme,
          new_theme: newTheme
        });
        
        htmlElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
        updateNavbarTheme(newTheme);
      });

      function updateThemeIcon(theme) {
        if (theme === 'dark') {
          themeIcon.className = 'fas fa-sun';
        } else {
          themeIcon.className = 'fas fa-moon';
        }
      }

      function updateNavbarTheme(theme) {
        const navbar = document.querySelector('.navbar-custom');
        if (!navbar) return;

        if (theme === 'dark') {
          navbar.classList.remove('navbar-light');
          navbar.classList.add('navbar-dark');
        } else {
          navbar.classList.remove('navbar-dark');
          navbar.classList.add('navbar-light');
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        let currentFileUint8Array = null; // Added
        const fileInput = document.getElementById('shaFileInput');
        const calculateBtn = document.getElementById('calculateShaBtn');
        const resultDiv = document.getElementById('shaResult');
        const loadingDiv = document.getElementById('shaLoading');
        const fileName = document.getElementById('selectedFileName');
        const advancedAnalyzer = new AdvancedFileAnalyzer();
        const fileCarvingEngine = new AdvancedFileCarvingEngine();

        fileInput.addEventListener('change', function() {
          const file = this.files[0];
          if (file) {
            // Track file selection
            window.trackEvent('File Selected', {
              file_name: file.name,
              file_size: file.size,
              file_type: file.type,
              file_extension: file.name.split('.').pop().toLowerCase()
            });
            // Check file size limit (100 MB)
            const maxSizeBytes = 100 * 1024 * 1024; // 100 MB
            
            if (file.size > maxSizeBytes) {
              fileName.textContent = `‚ùå File too large: ${formatFileSize(file.size)} (max 100 MB)`;
              fileName.style.color = '#dc3545'; // Red color
              calculateBtn.disabled = true;
              document.getElementById('fileCarvingBtn').disabled = true;
              document.getElementById('visualFileMapBtn').disabled = true;
              resultDiv.style.display = 'none';
              document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide card on error
              
              alert(`File is too large for analysis.\n\nFile size: ${formatFileSize(file.size)}\nMaximum allowed: 100 MB\n\nPlease select a smaller file.`);
              
              this.value = '';
              currentFileUint8Array = null; // Reset
              return;
            }
            
            fileName.textContent = file.name;
            fileName.style.color = '';
            calculateBtn.disabled = false;
            document.getElementById('fileCarvingBtn').disabled = false;
            document.getElementById('visualFileMapBtn').disabled = false;
            resultDiv.style.display = 'none';
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide until analysis
            currentFileUint8Array = null; // Reset on new file selection
          } else {
            fileName.textContent = 'No file selected';
            fileName.style.color = '';
            calculateBtn.disabled = true;
            document.getElementById('fileCarvingBtn').disabled = true;
            document.getElementById('visualFileMapBtn').disabled = true;
            resultDiv.style.display = 'none';
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide card
            currentFileUint8Array = null; // Reset
          }
        });

        calculateBtn.addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          // Track file analysis start
          window.trackEvent('File Analysis Started', {
            file_name: file.name,
            file_size: file.size,
            file_type: file.type,
            analysis_type: 'hash_and_metadata'
          });
          
          // Start timer for analysis duration
          window.startTimer('File Analyzed');

          calculateBtn.disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';
          document.getElementById('bytePatternAnalysisCard').style.display = 'none';


          try {
            // Use enhanced metadata extraction AND advanced analysis
            const fileBufferForPatterns = await file.arrayBuffer(); // Read buffer once for all analyses
            currentFileUint8Array = new Uint8Array(fileBufferForPatterns.slice(0)); // Store a copy for N-grams

            const [hashes, metadata, advancedResults] = await Promise.all([
              calculateMultipleSHA(file), // This will re-read or use its own buffer logic
              extractEnhancedFileMetadata(file), // Same here
              advancedAnalyzer.analyzeFile(file) // Same here
            ]);
            
            document.getElementById('sha1Value').textContent = hashes['SHA-1'];
            document.getElementById('sha256Value').textContent = hashes['SHA-256'];
            document.getElementById('sha384Value').textContent = hashes['SHA-384'];
            document.getElementById('sha512Value').textContent = hashes['SHA-512'];
            
            document.getElementById('metaFileName').textContent = metadata.name;
            document.getElementById('metaFileSize').textContent = metadata.sizeFormatted;
            document.getElementById('metaFileType').textContent = metadata.type;
            document.getElementById('metaFileExtension').textContent = metadata.extension;
            document.getElementById('metaLastModified').textContent = metadata.lastModified.toLocaleString();
            
            const imageMetadataDiv = document.getElementById('imageMetadata');
            if (metadata.image) {
              document.getElementById('imageDimensions').textContent = `${metadata.image.width} √ó ${metadata.image.height} pixels`;
              document.getElementById('imageAspectRatio').textContent = metadata.image.aspectRatio;
              imageMetadataDiv.style.display = 'block';
            } else {
              imageMetadataDiv.style.display = 'none';
            }
            
            populateEnhancedMetadata(metadata);
            populateAdvancedAnalysis(advancedResults);

            // New: Byte Pattern Analysis
            if (currentFileUint8Array) { // Check if currentFileUint8Array was populated
                // Calculate and display byte frequencies
                const frequencies = window.BytePatternAnalyzerLogic.calculateByteFrequencies(currentFileUint8Array);
                window.BytePatternAnalyzerLogic.displayByteFrequencyChart(frequencies, 'byteFrequencyChartCanvas');

                // Calculate and display Shannon Entropy
                const totalBytesForEntropy = currentFileUint8Array.length;
                const entropy = window.BytePatternAnalyzerLogic.calculateShannonEntropy(frequencies, totalBytesForEntropy);
                const entropyDisplayEl = document.getElementById('entropyDisplay');
                if (entropyDisplayEl) {
                    entropyDisplayEl.textContent = `Entropy: ${entropy.toFixed(3)} bits/byte`;
                }
                // The interpretation text is static HTML, so no need to update it here unless dynamic levels are needed.

                // Calculate and display N-grams for default N
                const defaultNgramN = parseInt(document.getElementById('ngramNValue').value, 10) || 2;
                const ngrams = window.BytePatternAnalyzerLogic.calculateNGrams(currentFileUint8Array, defaultNgramN);
                window.BytePatternAnalyzerLogic.displayNGramTable(ngrams, 'ngramResultsTableContainer');

                // Show the pattern analysis card
                document.getElementById('bytePatternAnalysisCard').style.display = 'block';
            }
            
            resultDiv.style.display = 'block';
            
            // Track successful file analysis (completes the timer)
            window.trackEvent('File Analyzed', {
              file_name: file.name,
              file_size: file.size,
              file_type: file.type,
              has_image_metadata: !!metadata.image,
              entropy: metadata.binary?.entropy,
              analysis_type: 'hash_and_metadata',
              success: true
            });
          } catch (error) {
            alert('Error processing file: ' + error.message);
            console.error("Processing error:", error); // Log error for details
            currentFileUint8Array = null; // Reset on error
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide on error
            
            // Track file analysis error
            window.trackEvent('File Analysis Failed', {
              file_name: file.name,
              file_size: file.size,
              file_type: file.type,
              error: error.message,
              analysis_type: 'hash_and_metadata',
              success: false
            });
          } finally {
            loadingDiv.style.display = 'none';
            calculateBtn.disabled = false;
          }
        });
        
        // Event listener for N-gram analysis button
        document.getElementById('analyzeNGramsBtn').addEventListener('click', function() {
            if (!currentFileUint8Array) {
                alert('Please analyze a file first.');
                return;
            }
            const nValue = parseInt(document.getElementById('ngramNValue').value, 10);
            if (isNaN(nValue) || nValue < 1 || nValue > 5) {
                alert('Please enter a valid N value (1-5).');
                return;
            }
            const ngrams = window.BytePatternAnalyzerLogic.calculateNGrams(currentFileUint8Array, nValue);
            window.BytePatternAnalyzerLogic.displayNGramTable(ngrams, 'ngramResultsTableContainer');
        });

        // File Carving Button Event Listener
        document.getElementById('fileCarvingBtn').addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          this.disabled = true;
          calculateBtn.disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';
          document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide during carving


          try {
            loadingDiv.querySelector('p').textContent = 'Performing advanced file carving and embedded object extraction...';
            
            const carvingResults = await fileCarvingEngine.analyzeFile(file);
            
            let carvingContainer = document.getElementById('fileCarvingResults');
            if (!carvingContainer) {
              carvingContainer = document.createElement('div');
              carvingContainer.id = 'fileCarvingResults';
              resultDiv.parentNode.insertBefore(carvingContainer, resultDiv.nextSibling);
            }
            
            fileCarvingUI.renderCarvingResults(carvingResults, carvingContainer);
            carvingContainer.style.display = 'block';
            
          } catch (error) {
            alert('File carving failed: ' + error.message);
            console.error('File carving error:', error);
          } finally {
            loadingDiv.style.display = 'none';
            this.disabled = false;
            calculateBtn.disabled = false;
            loadingDiv.querySelector('p').textContent = 'Performing forensic analysis and extracting metadata...';
          }
        });

        // Visual File Map Button Event Listener
        document.getElementById('visualFileMapBtn').addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          this.disabled = true;
          calculateBtn.disabled = true;
          document.getElementById('fileCarvingBtn').disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';

          try {
            loadingDiv.querySelector('p').textContent = 'Creating interactive visual file structure map...';
            
            const visualMap = new VisualFileMap();
            const structure = await visualMap.analyzeFileStructure(file);
            
            // Create or update visualization container
            let visualContainer = document.getElementById('visualFileMapContainer');
            if (!visualContainer) {
              visualContainer = document.createElement('div');
              visualContainer.id = 'visualFileMapContainer';
              visualContainer.className = 'mt-4';
              visualContainer.innerHTML = `
                <div class="card">
                  <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                      <i class="fas fa-project-diagram mr-2"></i>Interactive Visual File Structure Map
                    </h5>
                  </div>
                  <div class="card-body" id="visualMapCanvas">
                    <!-- Canvas will be inserted here -->
                  </div>
                </div>
              `;
              resultDiv.parentNode.insertBefore(visualContainer, resultDiv.nextSibling);
            }
            
            // Create visualization
            const canvasContainer = document.getElementById('visualMapCanvas');
            visualMap.createVisualization(structure, canvasContainer);
            
            visualContainer.style.display = 'block';
            
            // Show example of the space-to-newline function
            const exampleText = "This is a test string with spaces";
            const convertedText = visualMap.replaceSpacesWithNewlines(exampleText);
            console.log("Space to newline conversion example:");
            console.log("Original:", exampleText);
            console.log("Converted:", convertedText);
            
          } catch (error) {
            alert('Visual file map creation failed: ' + error.message);
            console.error('Visual file map error:', error);
          } finally {
            loadingDiv.style.display = 'none';
            this.disabled = false;
            calculateBtn.disabled = false;
            document.getElementById('fileCarvingBtn').disabled = false;
            loadingDiv.querySelector('p').textContent = 'Performing forensic analysis and extracting metadata...';
          }
        });
        
        function populateAdvancedAnalysis(advanced) {
          const resultDiv = document.getElementById('advancedAnalysisResult');
          resultDiv.innerHTML = ''; // Clear previous results

          let advancedHTML = '<h3 class="text-center mb-4"><i class="fas fa-microscope mr-2"></i>Advanced Forensic Analysis</h3>';
          
          // Interactive Hex Viewer
          if (advanced.hexViewer) {
            advancedHTML += createHexViewer(advanced.hexViewer);
          }
          
          // Entropy Visualization
          if (advanced.entropyViz) {
            advancedHTML += createEntropyVisualization(advanced.entropyViz);
          }
          
          // String Extraction
          if (advanced.strings) {
            advancedHTML += createStringAnalysis(advanced.strings);
          }
          
          // Binary Pattern Analysis
          if (advanced.binaryPatterns) {
            advancedHTML += createBinaryPatternAnalysis(advanced.binaryPatterns);
          }
          
          // Cryptographic Analysis
          if (advanced.cryptoAnalysis) {
            advancedHTML += createCryptoAnalysis(advanced.cryptoAnalysis);
          }
          
          // Image-specific advanced features
          if (advanced.qrCodes) {
            advancedHTML += createQRCodeAnalysis(advanced.qrCodes);
          }
          
          if (advanced.steganography) {
            advancedHTML += createSteganographyAnalysis(advanced.steganography);
          }
          
          if (advanced.imageForensics) {
            advancedHTML += createImageForensics(advanced.imageForensics);
          }
          
          if (advanced.geoLocation && advanced.geoLocation.hasGPS) {
            advancedHTML += createGeoLocationAnalysis(advanced.geoLocation);
          }
          
          // Audio analysis
          if (advanced.spectralAnalysis) {
            advancedHTML += createSpectralAnalysis(advanced.spectralAnalysis);
          }
          
          resultDiv.innerHTML = advancedHTML;
        }
        
        function createHexViewer(hexData) {
          let html = `
            <div class="card mb-3">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                  <i class="fas fa-code mr-2"></i>Interactive Hex Viewer
                  <span class="badge badge-light ml-2">${hexData.totalBytes.toLocaleString()} bytes</span>
                </h5>
              </div>
              <div class="card-body p-0">
                <div class="hex-viewer" style="font-family: 'Courier New', monospace; font-size: 12px; background: #000; color: #0f0; padding: 15px; max-height: 400px; overflow-y: auto;">
          `;
          
          hexData.hexRows.forEach(row => {
            html += `
              <div class="hex-row" style="margin-bottom: 2px;">
                <span style="color: #888; margin-right: 15px;">${row.offset}</span>
                <span style="margin-right: 15px;">${row.hex}</span>
                <span style="color: #ff0; background: rgba(255,255,0,0.1); padding: 0 5px;">${row.ascii}</span>
              </div>
            `;
          });
          
          if (hexData.hasMore) {
            html += '<div class="text-center" style="color: #888; margin-top: 10px;">... (showing first 2KB)</div>';
          }
          
          html += `
                </div>
              </div>
            </div>
          `;
          
          return html;
        }
        
        function createEntropyVisualization(entropyData) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-chart-area mr-2"></i>Entropy Visualization
                  <span class="badge badge-light ml-2">${entropyData.data.length} blocks</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="text-center mb-3">
                  <img src="${entropyData.visualization}" alt="Entropy Graph" class="img-fluid" style="max-width: 100%; border: 1px solid #ddd;">
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>High Entropy Regions:</strong> ${entropyData.analysis.highEntropyPercentage}%</p>
                    <p><strong>Low Entropy Regions:</strong> ${entropyData.analysis.lowEntropyPercentage}%</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong>Suspicious Regions:</strong> ${entropyData.analysis.suspiciousRegions.length}</p>
                    <p><strong>Structured Regions:</strong> ${entropyData.analysis.structuredRegions.length}</p>
                  </div>
                </div>
                <div class="mt-2">
                  <small class="text-muted">
                    <span style="color: #0066cc;">‚ñà</span> Low entropy (structured) 
                    <span style="color: #ffaa00;">‚ñà</span> Medium entropy 
                    <span style="color: #ff6600;">‚ñà</span> High entropy 
                    <span style="color: #ff0000;">‚ñà</span> Very high (encrypted/random)
                  </small>
                </div>
              </div>
            </div>
          `;
        }
        
        function escapeHtml(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }

        function createStringAnalysis(stringData) {
          let html = `
            <div class="card mb-3">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="fas fa-search mr-2"></i>String Extraction
                  <span class="badge badge-light ml-2">${stringData.total} strings found</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="row mb-3">
          `;
          
          for (const [category, count] of Object.entries(stringData.categories)) {
            html += `<div class="col-md-4"><span class="badge badge-info">${category}</span> ${count}</div>`;
          }
          
          html += `
                </div>
                <div style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;">
          `;
          
          const displayStrings = stringData.strings.slice(0, 20);
          displayStrings.forEach(str => {
            const colorClass = getStringTypeColor(str.type);
            html += `
              <div class="string-item mb-2" style="border-left: 3px solid ${colorClass}; padding-left: 8px;">
                <span class="badge badge-secondary" style="font-size: 10px;">0x${str.offset.toString(16).toUpperCase()}</span>
                <span class="badge badge-primary">${str.type}</span>
                <code style="font-size: 11px;">${escapeHtml(str.content.substring(0, 80))}${str.content.length > 80 ? '...' : ''}</code>
              </div>
            `;
          });
          
          if (stringData.strings.length > 20) {
            html += `<div class="text-center"><em>... and ${stringData.strings.length - 20} more strings</em></div>`;
          }
          
          html += `
                </div>
              </div>
            </div>
          `;
          
          return html;
        }
        
        function getStringTypeColor(type) {
            const colors = {
                'URL': '#007bff',
                'IPv4': '#28a745',
                'Email': '#dc3545',
                'File Path': '#ffc107',
                'Credit Card': '#fd7e14',
                'Generic': '#6c757d'
            };
            return colors[type] || colors['Generic'];
        }

        function createBinaryPatternAnalysis(patterns) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-chart-pie mr-2"></i>Binary Pattern Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>Null Bytes:</strong> ${patterns.nullBytes.toLocaleString()}</p>
                    <p><strong>Repeating Bytes:</strong> ${patterns.repeatingBytes.toLocaleString()}</p>
                    <p><strong>Sequential Bytes:</strong> ${patterns.sequentialBytes.toLocaleString()}</p>
                    <p><strong>Randomness Score:</strong> ${patterns.randomness}%</p>
                  </div>
                  <div class="col-md-6">
                    <div class="alert alert-light">
                      <strong>Analysis:</strong>
                      <ul class="mb-0 mt-2">
                        ${patterns.analysis.map(item => `<li>${item}</li>`).join('')}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        
        function createCryptoAnalysis(crypto) {
          const alertClass = crypto.possibleEncryption ? 'alert-warning' : 'alert-success';
          return `
            <div class="card mb-3">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-shield-alt mr-2"></i>Cryptographic Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="alert ${alertClass}">
                  <strong>Encryption Detected:</strong> ${crypto.possibleEncryption ? '‚ö†Ô∏è POSSIBLE' : '‚úÖ UNLIKELY'}
                  <br><strong>Entropy Score:</strong> ${crypto.entropy.toFixed(3)}/8.0
                </div>
                ${crypto.keySchedulePatterns.length > 0 ? `
                  <div class="mt-3">
                    <strong>Key Schedule Patterns:</strong>
                    <ul>${crypto.keySchedulePatterns.map(pattern => `<li>${pattern}</li>`).join('')}</ul>
                  </div>
                ` : ''}
                ${crypto.blockCipherIndicators.length > 0 ? `
                  <div class="mt-3">
                    <strong>Block Cipher Indicators:</strong>
                    <ul>${crypto.blockCipherIndicators.map(indicator => `<li>${indicator}</li>`).join('')}</ul>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        }

        // Joke Generator listener setup
        const jokeForm = document.getElementById('jokeForm');
        if (jokeForm) {
          jokeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const topicInput = document.getElementById('jokeTopic');
            const topic = topicInput ? topicInput.value.trim() : '';
            if (topic) {
              fetchJoke(topic);
            }
          });
        }
    }); // This closes the main 'DOMContentLoaded' listener

    async function fetchJoke(topic) {
      const loadingDiv = document.getElementById('jokeLoading');
      const resultDiv = document.getElementById('jokeResult');
      const jokeContent = document.getElementById('jokeContent');
      const getJokeBtn = document.getElementById('getJokeBtn');

      if (loadingDiv) loadingDiv.style.display = 'block';
      if (resultDiv) resultDiv.style.display = 'none';
      if (getJokeBtn) getJokeBtn.disabled = true;

      try {
        const response = await fetch(`/joke?topic=${encodeURIComponent(topic)}`);
        if (!response.ok) {
          throw new Error(`API returned status ${response.status}`);
        }
        const jokeText = await response.text();
        if (jokeContent) jokeContent.textContent = jokeText;
        if (resultDiv) resultDiv.style.display = 'block';

        if(window.trackEvent) {
            window.trackEvent('Joke Generated', {
                topic: topic,
                joke_length: jokeText.length,
                success: true
            });
        }

      } catch (error) {
        console.error('Error fetching joke:', error);
        if (jokeContent) {
          jokeContent.innerHTML = `<div class="alert alert-danger">Oops! Our comedian has stage fright. Please try again.</div>`;
        }
        if (resultDiv) resultDiv.style.display = 'block';
        
        if(window.trackEvent) {
            window.trackEvent('Joke Generation Failed', {
                topic: topic,
                error: error.message,
                success: false
            });
        }
      } finally {
        if (loadingDiv) loadingDiv.style.display = 'none';
        if (getJokeBtn) getJokeBtn.disabled = false;
      }
    }

    function copyToClipboard(elementId, button) {
        const text = document.getElementById(elementId).textContent;
        navigator.clipboard.writeText(text).then(function() {
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(function() {
                button.innerHTML = originalText;
            }, 2000);
        }, function(err) {
            alert('Could not copy text: ', err);
        });
    }

    // Tech News functionality
    async function fetchTechNews(forceRefresh = false) {
      const loadingDiv = document.getElementById('newsLoading');
      const errorDiv = document.getElementById('newsError');
      const newsContainer = document.getElementById('newsContainer');
      const refreshBtn = document.getElementById('refreshNewsBtn');
      
      // Hide error, show loading
      if (errorDiv) errorDiv.style.display = 'none';
      if (loadingDiv) loadingDiv.style.display = 'block';
      if (newsContainer) newsContainer.innerHTML = '';
      if (refreshBtn) {
        refreshBtn.classList.add('loading');
        refreshBtn.disabled = true;
      }

      try {
        const url = forceRefresh ? '/api/tech-news?refresh=true' : '/api/tech-news';
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`API returned status ${response.status}`);
        }

        const data = await response.json();
        
        if (!data.stories || data.stories.length === 0) {
          throw new Error('No news stories available');
        }

        // Track successful news fetch
        if (window.trackEvent) {
          window.trackEvent('Tech News Loaded', {
            stories_count: data.stories.length,
            source: data.source,
            force_refresh: forceRefresh,
            success: true
          });
        }

        // Render news cards
        renderNewsStories(data.stories);

        // Hide loading
        if (loadingDiv) loadingDiv.style.display = 'none';

      } catch (error) {
        console.error('Error fetching tech news:', error);
        
        // Track error
        if (window.trackEvent) {
          window.trackEvent('Tech News Load Failed', {
            error: error.message,
            force_refresh: forceRefresh,
            success: false
          });
        }

        // Show error message
        if (errorDiv) {
          const errorText = document.getElementById('newsErrorText');
          if (errorText) {
            errorText.textContent = `Failed to load news: ${error.message}. Please try again later.`;
          }
          errorDiv.style.display = 'block';
        }
        
        if (loadingDiv) loadingDiv.style.display = 'none';
      } finally {
        if (refreshBtn) {
          refreshBtn.classList.remove('loading');
          refreshBtn.disabled = false;
        }
      }
    }

    function renderNewsStories(stories) {
      const container = document.getElementById('newsContainer');
      if (!container) return;

      container.innerHTML = '';

      stories.forEach(story => {
        const storyCard = createNewsCard(story);
        const colDiv = document.createElement('div');
        colDiv.className = 'col-md-6 mb-3';
        colDiv.appendChild(storyCard);
        container.appendChild(colDiv);
      });
    }

    function createNewsCard(story) {
      const card = document.createElement('div');
      card.className = 'news-card';

      // Format time
      const timeAgo = formatTimeAgo(story.time);

      card.innerHTML = `
        <div class="news-card-header">
          <h4 class="news-card-title">
            <a href="${escapeHtml(story.url)}" target="_blank" rel="noopener noreferrer" 
               onclick="if(window.trackEvent) window.trackEvent('Tech News Clicked', {story_id: ${story.id}, story_title: '${escapeHtml(story.title).substring(0, 50)}'});">
              ${escapeHtml(story.title)}
            </a>
          </h4>
        </div>
        ${story.domain ? `
          <div class="news-card-domain">
            <i class="fas fa-globe"></i>
            ${escapeHtml(story.domain)}
          </div>
        ` : ''}
      `;

      return card;
    }

    function formatTimeAgo(isoString) {
      if (!isoString) return 'unknown';
      
      const now = new Date();
      const time = new Date(isoString);
      const diffMs = now - time;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'just now';
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      
      return time.toLocaleDateString();
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize tech news on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Fetch news when page loads
      fetchTechNews();
      
      // Add refresh button listener
      const refreshBtn = document.getElementById('refreshNewsBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          fetchTechNews(true);
        });
      }
    });

  </script>
</body>
</html>