<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Product Showcase - Explore our innovative products">
    <meta name="author" content="Siddharth Kulkarni">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Product Showcase</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
      :root {
        --primary-color: #4a6fa5;
        --secondary-color: #6e9887;
        --accent-color: #ffc107;
        --light-bg: #f8f9fa;
        --dark-text: #333;
        --card-bg: #ffffff;
        --border-color: rgba(0,0,0,0.1);
        --text-muted: #666;
        --shadow-color: rgba(0,0,0,0.1);
      }

      [data-theme="dark"] {
        --primary-color: #6b8cc4;
        --secondary-color: #8ab4a1;
        --accent-color: #ffd54f;
        --light-bg: #1a1a1a;
        --dark-text: #e0e0e0;
        --card-bg: #2d2d2d;
        --border-color: rgba(255,255,255,0.1);
        --text-muted: #b0b0b0;
        --shadow-color: rgba(0,0,0,0.3);
      }
      
      body {
        font-family: 'Roboto', sans-serif;
        background-color: var(--light-bg);
        color: var(--dark-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .site-header {
        background-color: var(--card-bg);
        box-shadow: 0 2px 10px var(--shadow-color);
        padding: 1rem 0;
        margin-bottom: 2rem;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }
      
      .site-title {
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 0;
      }
      
      .navbar-custom {
        background-color: var(--card-bg);
        padding: 0.5rem 1rem;
      }

      .theme-toggle {
        background: none;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 1rem;
      }

      .theme-toggle:hover {
        background-color: var(--primary-color);
        color: var(--card-bg);
      }

      .theme-toggle:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.3);
      }
      
      .navbar-custom .nav-link {
        color: var(--primary-color);
        font-weight: 500;
        margin: 0 0.5rem;
        transition: color 0.3s ease;
      }
      
      .navbar-custom .nav-link:hover {
        color: var(--secondary-color);
      }
      
      .main-banner {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 4rem 0;
        margin-bottom: 3rem;
        text-align: center;
      }
      
      .search-card {
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--shadow-color);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: transform 0.2s ease, background-color 0.3s ease, box-shadow 0.3s ease;
      }
      
      .search-card:hover {
        transform: translateY(-5px);
      }
      
      .search-btn {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      
      .search-btn:hover {
        background-color: #3a5a80;
        border-color: #3a5a80;
      }
      
      .feature-box {
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        height: 100%;
        box-shadow: 0 4px 6px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
      }
      
      .feature-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px var(--shadow-color);
      }
      
      .feature-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }
      
      .feature-title {
        color: var(--secondary-color);
        font-weight: 600;
      }
      
      .btn-feature {
        background-color: var(--primary-color);
        color: white;
        margin-top: 1rem;
        transition: background-color 0.3s ease;
      }
      
      .btn-feature:hover {
        background-color: var(--secondary-color);
        color: white;
      }
      
      .product-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 6px 15px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        height: 100%;
        overflow: hidden;
        position: relative;
      }
      
      .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px var(--shadow-color);
      }
      
      .product-img {
        height: 180px;
        background-size: cover;
        background-position: center;
        position: relative;
      }
      
      .product-img::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40%;
        background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
      }
      
      .product-icon {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--accent-color);
        color: var(--dark-text);
        font-size: 1.8rem;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        z-index: 10;
      }
      
      .product-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: var(--primary-color);
        color: white;
        font-size: 0.8rem;
        padding: 5px 10px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        z-index: 10;
      }
      
      .product-body {
        padding: 1.8rem;
      }
      
      .product-title {
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 0.8rem;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
      }
      
      .product-title .icon {
        margin-right: 10px;
        color: var(--accent-color);
      }
      
      .product-description {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }
      
      footer {
        background-color: var(--card-bg);
        padding: 1.5rem 0;
        margin-top: auto;
        box-shadow: 0 -2px 10px var(--shadow-color);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      .card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .custom-file-label {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--dark-text);
      }

      .form-control {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--dark-text);
      }

      .form-control:focus {
        background-color: var(--card-bg);
        border-color: var(--primary-color);
        color: var(--dark-text);
      }

      code {
        background-color: var(--light-bg);
        color: var(--dark-text);
        border: 1px solid var(--border-color);
      }
      
      /* Visual File Map Styles */
      #visualMapCanvas {
        position: relative;
        min-height: 600px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 8px;
        overflow: hidden;
      }
      
      [data-theme="dark"] #visualMapCanvas {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      }
      
      #visualMapCanvas canvas {
        display: block;
        margin: 0 auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      .visual-map-controls {
        margin-top: 1rem;
        padding: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 2px 6px var(--shadow-color);
      }
      
      #vmNodeDetails {
        animation: fadeIn 0.3s ease-in-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      
      .new-feature-badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(238, 90, 36, 0.3);
        animation: pulse 2s infinite;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-custom">
          <a class="navbar-brand" href="/">
            <h1 class="site-title">Product Showcase</h1>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="/">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#products">Products</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#featured">Featured</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#file-sha">File Analysis</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/animations">Animations</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#about">About</a>
              </li>
              <li class="nav-item">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                  <i class="fas fa-moon" id="themeIcon"></i>
                </button>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    
    <div class="main-banner">
      <div class="container">
        <h2 class="display-4">Innovative Products and Services</h2>
        <p class="lead">Explore our collection of cutting-edge tools and applications</p>
      </div>
    </div>
    
    <main class="container">
      <section id="featured" class="mb-5">
        <h2 class="text-center mb-4">Featured Product</h2>
        <section id="joke-generator" class="mb-5">
          <h2 class="text-center mb-5">
            AI Joke Generator 
            <span class="badge badge-danger ml-2" style="font-size: 0.5em; vertical-align: middle; animation: pulse 2s infinite;">NEW</span>
          </h2>
                     <div class="row justify-content-center">
             <div class="col-md-8">
               <div class="search-card" style="position: relative; overflow: visible;">
                 <span class="new-feature-badge">
                   <i class="fas fa-sparkles mr-1"></i>NEW
                 </span>
                 <div class="d-flex align-items-center mb-3">
                   <i class="fas fa-laugh-beam fa-2x text-warning mr-3"></i>
                   <h2 class="mb-0">Get a Joke on Any Topic!</h2>
                </div>
                <p class="lead mb-4">Our AI comedian is ready to make you laugh. Just tell us what you want a joke about!</p>
                <form id="jokeForm">
                  <div class="input-group mb-3">
                    <input type="text" id="jokeTopic" name="topic" class="form-control form-control-lg" placeholder="Enter a topic (e.g., programming, cats, coffee...)" required>
                    <div class="input-group-append">
                      <button class="btn btn-primary search-btn" type="submit" id="getJokeBtn">
                        <i class="fas fa-magic mr-2"></i>Get Joke
                      </button>
                    </div>
                  </div>
                </form>
                
                <div id="jokeLoading" class="text-center mt-3" style="display: none;">
                  <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <p class="mt-2 text-muted">Our AI comedian is thinking of something funny...</p>
                </div>
                
                <div id="jokeResult" class="mt-4" style="display: none;">
                  <div class="card">
                    <div class="card-header bg-warning text-dark">
                      <h5 class="mb-0">
                        <i class="fas fa-smile-wink mr-2"></i>Here's Your Joke!
                      </h5>
                    </div>
                    <div class="card-body">
                      <div id="jokeContent" style="font-size: 1.2rem; line-height: 1.8; color: var(--dark-text);">
                        <!-- Joke will be displayed here -->
                      </div>
                      <div class="mt-3">
                        <button class="btn btn-sm btn-outline-warning" onclick="getAnotherJoke()">
                          <i class="fas fa-redo mr-1"></i>Another One!
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="mt-3">
                  <small class="text-muted">
                    <i class="fas fa-brain mr-1"></i>
                    Powered by advanced AI language models for creative and contextual humor.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </section>
                  <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="search-card">
                <div class="d-flex align-items-center mb-3">
                  <i class="fas fa-book-open fa-2x text-warning mr-3"></i>
                  <h2 class="mb-0">Word Explorer</h2>
              </div>
              <p class="lead mb-4">Our powerful dictionary and language tool</p>
              <form action="/word-usage" method="get">
                <div class="input-group mb-3">
                  <input type="text" name="word" class="form-control form-control-lg" placeholder="Enter a word..." required>
                  <div class="input-group-append">
                    <button class="btn btn-primary search-btn" type="submit">Search</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
      
      <section id="file-sha" class="mb-5">
        <h2 class="text-center mb-4">File Hash Calculator & Metadata Extractor</h2>
        <div class="row justify-content-center">
          <div class="col-md-10">
            <div class="search-card">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-fingerprint fa-2x text-primary mr-3"></i>
                <h2 class="mb-0">Professional File Forensics Tool</h2>
              </div>
              <p class="lead mb-4">Professional-grade file analysis with forensic capabilities: SHA hashes, hex viewer, entropy visualization, string extraction, advanced file carving & embedded object extraction, polyglot detection, steganography analysis, and more. All processing happens in your browser for maximum privacy and security.</p>
              
              <div class="custom-file mb-3">
                <input type="file" class="custom-file-input" id="shaFileInput" accept="*/*">
                <label class="custom-file-label" for="shaFileInput">Choose file...</label>
              </div>
              
              <div class="mb-3">
                <small class="text-muted">Selected file: <span id="selectedFileName" class="font-weight-bold">No file selected</span></small>
                <br>
                <small class="text-info"><i class="fas fa-info-circle mr-1"></i>Maximum file size: 100 MB</small>
              </div>
              
              <button id="calculateShaBtn" class="btn btn-primary btn-lg btn-block" disabled>
                <i class="fas fa-microscope mr-2"></i>Perform Advanced Forensic Analysis
              </button>
              
              <button id="fileCarvingBtn" class="btn btn-danger btn-lg btn-block mt-2" disabled>
                <i class="fas fa-search-plus mr-2"></i>Advanced File Carving & Embedded Object Extraction
              </button>
              
              <button id="visualFileMapBtn" class="btn btn-warning btn-lg btn-block mt-2" disabled>
                <i class="fas fa-project-diagram mr-2"></i>Interactive Visual File Structure Map (NEW!)
              </button>
              
              <div id="shaLoading" class="text-center mt-3" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                  <span class="sr-only">Processing...</span>
                </div>
                <p class="mt-2 text-muted">Performing forensic analysis and extracting metadata...</p>
              </div>
              
              <div id="shaResult" class="mt-4" style="display: none;">
                <!-- File Metadata Card -->
                <div class="card mb-3">
                  <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                      <i class="fas fa-info-circle mr-2"></i>File Metadata
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>File Name:</strong> <span id="metaFileName"></span></p>
                        <p><strong>File Size:</strong> <span id="metaFileSize"></span></p>
                        <p><strong>File Type:</strong> <span id="metaFileType"></span></p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Extension:</strong> <span id="metaFileExtension"></span></p>
                        <p><strong>Last Modified:</strong> <span id="metaLastModified"></span></p>
                        <div id="imageMetadata" style="display: none;">
                          <p><strong>Dimensions:</strong> <span id="imageDimensions"></span></p>
                          <p><strong>Aspect Ratio:</strong> <span id="imageAspectRatio"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Hash Results Card -->
                <div class="card">
                  <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                      <i class="fas fa-check-circle mr-2"></i>Hash Values
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-1:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha1Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha1Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-256:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha256Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha256Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-384:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha384Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha384Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                    
                    <div class="hash-result mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>SHA-512:</strong>
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('sha512Value', this)">
                          <i class="fas fa-copy"></i> Copy
                        </button>
                      </div>
                      <code id="sha512Value" class="text-break d-block p-2 bg-light border rounded"></code>
                    </div>
                  </div>
                </div>

              <!-- Byte Pattern Analysis Card -->
              <div id="bytePatternAnalysisCard" class="card mt-4" style="display: none;">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0">
                    <i class="fas fa-chart-bar mr-2"></i>Byte Pattern Analysis
                  </h5>
                </div>
                <div class="card-body">
                  <!-- Shannon Entropy Display -->
                  <div class="mb-3">
                    <h6>Shannon Entropy</h6>
                    <p id="entropyDisplay" class="lead" style="font-size: 1.1rem;">Not yet calculated.</p>
                    <small id="entropyInterpretation" class="text-muted">Measures the randomness/uncertainty of data. Ranges from 0 (no uncertainty) to 8.0 (maximum uncertainty for byte data). High values often indicate compressed or encrypted data. Low values suggest redundancy, like plain text or structured binary data.</small>
                  </div>
                  <hr>
                  <!-- Byte Frequency Chart -->
                  <div class="mb-3">
                    <h6>Byte Frequency Distribution (0-255)</h6>
                    <div class="mb-1 d-flex justify-content-around flex-wrap">
                        <small><span style="color: #28a745;">■</span> Printable ASCII (0x20-0x7E)</small>
                        <small><span style="color: #fd7e14;">■</span> Control Chars (0x00-0x1F, 0x7F)</small>
                        <small><span style="color: #007bff;">■</span> Extended/Binary (0x80-0xFF)</small>
                    </div>
                    <canvas id="byteFrequencyChartCanvas" width="400" height="200"></canvas>
                    <small class="text-muted">Shows frequency of each byte value. Colors indicate byte type (see legend). Helps identify data patterns, compression, or encryption.</small>
                  </div>
                  <hr>
                  <!-- N-gram Analysis -->
                  <div>
                    <h6>N-gram Analysis (Common Byte Sequences)</h6>
                    <div class="form-row align-items-center mb-2">
                      <div class="col-auto">
                        <label for="ngramNValue" class="col-form-label">N-gram length (N):</label>
                      </div>
                      <div class="col-auto">
                        <input type="number" class="form-control form-control-sm" id="ngramNValue" value="2" min="1" max="5">
                      </div>
                      <div class="col-auto">
                        <button id="analyzeNGramsBtn" class="btn btn-sm btn-info">Analyze N-grams</button>
                      </div>
                    </div>
                    <div id="ngramResultsTableContainer" style="max-height: 300px; overflow-y: auto;">
                      <!-- N-gram table will be rendered here by JavaScript -->
                    </div>
                    <small class="text-muted">Shows the most frequent sequences of N bytes (N-grams). This can help identify file type signatures (magic numbers), repeated data structures, common opcodes in executables, or typical patterns in text or structured binary data.</small>
                  </div>
                </div>
              </div>
              </div>
              
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-shield-alt mr-1"></i>
                  Your file is processed entirely in your browser (max 100 MB). No data is sent to our servers.
                </small>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      
      <section id="products" class="mb-5">
        <h2 class="text-center mb-4">Our Products</h2>
        <div class="row">
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?dictionary')">
                <div class="product-icon">
                  <i class="fas fa-book-open"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-book"></i>
                  Word Explorer
                </h3>
                <p class="product-description">A comprehensive dictionary tool with AI-powered etymology and usage examples.</p>
                <a href="#featured" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?animation')">
                <div class="product-icon">
                  <i class="fas fa-magic"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-palette"></i>
                  Animation Gallery
                </h3>
                <p class="product-description">Interactive animations powered by P5.js. Experience particles, waves, fireworks and more.</p>
                <a href="/animations" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?security')">
                <div class="product-icon">
                  <i class="fas fa-fingerprint"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-shield-alt"></i>
                  File Analysis Tool
                </h3>
                <p class="product-description">Professional forensic analysis with hex viewer, entropy visualization, string extraction, file carving, steganography detection, and cryptographic analysis. Calculate multiple SHA hashes securely in your browser.</p>
                <a href="#file-sha" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <div class="product-card">
              <div class="product-img" style="background-image: url('https://source.unsplash.com/random/800x600/?comedy,laugh')">
                <div class="product-icon">
                  <i class="fas fa-laugh-beam"></i>
                </div>
                <div class="product-badge">Active</div>
              </div>
              <div class="product-body">
                <h3 class="product-title">
                  <i class="icon fas fa-smile-wink"></i>
                  Joke Generator
                </h3>
                <p class="product-description">Get AI-powered jokes on any topic. Powered by advanced language models for hilarious results.</p>
                <a href="#joke-generator" class="btn btn-feature">
                  <i class="fas fa-play-circle mr-2"></i>Try Now
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <section id="about" class="mb-5">
        <div class="card">
          <div class="card-body">
            <h2 class="card-title">
              <i class="fas fa-info-circle text-primary mr-2"></i>
              About Our Platform
            </h2>
            <p class="card-text">We create innovative tools and applications to help people communicate more effectively. Our products leverage cutting-edge technology to deliver powerful, user-friendly experiences.</p>
            <p class="card-text">Our platform is designed to be fast, intuitive, and accessible, making technology work for everyone.</p>
          </div>
        </div>
      </section>
    </main>
  
    <div class="container text-center" style="margin-top: 2rem;">
      <span class="text-muted">This Platform is Powered by <a href="https://www.contentstack.com/launch" target="_blank">ContentStack Launch</a></span>
    </div>
    
    <footer>
      <div class="container text-center">
        <span class="text-muted">Siddharth Kulkarni © 2025. All rights reserved.</span>
      </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script src="/javascript/file-sha-enhanced.js"></script>
    <script src="/javascript/advanced-analysis.js"></script>
    <script src="/javascript/file-carving-engine.js"></script>
    <script src="/javascript/file-carving-ui.js"></script>
    <script src="/javascript/byte-pattern-analyzer.js"></script>
    <script src="/javascript/visual-file-map.js"></script>
    <script>
      // Theme toggle functionality
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const htmlElement = document.documentElement;

      // Check for saved theme preference or default to 'light'
      const currentTheme = localStorage.getItem('theme') || 'light';
      htmlElement.setAttribute('data-theme', currentTheme);
      updateThemeIcon(currentTheme);

      themeToggle.addEventListener('click', () => {
        const newTheme = htmlElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        htmlElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
      });

      function updateThemeIcon(theme) {
        if (theme === 'dark') {
          themeIcon.className = 'fas fa-sun';
        } else {
          themeIcon.className = 'fas fa-moon';
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        let currentFileUint8Array = null; // Added
        const fileInput = document.getElementById('shaFileInput');
        const calculateBtn = document.getElementById('calculateShaBtn');
        const resultDiv = document.getElementById('shaResult');
        const loadingDiv = document.getElementById('shaLoading');
        const fileName = document.getElementById('selectedFileName');
        const advancedAnalyzer = new AdvancedFileAnalyzer();
        const fileCarvingEngine = new AdvancedFileCarvingEngine();

        fileInput.addEventListener('change', function() {
          const file = this.files[0];
          if (file) {
            // Check file size limit (100 MB)
            const maxSizeBytes = 100 * 1024 * 1024; // 100 MB
            
            if (file.size > maxSizeBytes) {
              fileName.textContent = `❌ File too large: ${formatFileSize(file.size)} (max 100 MB)`;
              fileName.style.color = '#dc3545'; // Red color
              calculateBtn.disabled = true;
              document.getElementById('fileCarvingBtn').disabled = true;
              document.getElementById('visualFileMapBtn').disabled = true;
              resultDiv.style.display = 'none';
              document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide card on error
              
              alert(`File is too large for analysis.\n\nFile size: ${formatFileSize(file.size)}\nMaximum allowed: 100 MB\n\nPlease select a smaller file.`);
              
              this.value = '';
              currentFileUint8Array = null; // Reset
              return;
            }
            
            fileName.textContent = file.name;
            fileName.style.color = '';
            calculateBtn.disabled = false;
            document.getElementById('fileCarvingBtn').disabled = false;
            document.getElementById('visualFileMapBtn').disabled = false;
            resultDiv.style.display = 'none';
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide until analysis
            currentFileUint8Array = null; // Reset on new file selection
          } else {
            fileName.textContent = 'No file selected';
            fileName.style.color = '';
            calculateBtn.disabled = true;
            document.getElementById('fileCarvingBtn').disabled = true;
            document.getElementById('visualFileMapBtn').disabled = true;
            resultDiv.style.display = 'none';
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide card
            currentFileUint8Array = null; // Reset
          }
        });

        calculateBtn.addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          calculateBtn.disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';
          document.getElementById('bytePatternAnalysisCard').style.display = 'none';


          try {
            // Use enhanced metadata extraction AND advanced analysis
            const fileBufferForPatterns = await file.arrayBuffer(); // Read buffer once for all analyses
            currentFileUint8Array = new Uint8Array(fileBufferForPatterns.slice(0)); // Store a copy for N-grams

            const [hashes, metadata, advancedResults] = await Promise.all([
              calculateMultipleSHA(file), // This will re-read or use its own buffer logic
              extractEnhancedFileMetadata(file), // Same here
              advancedAnalyzer.analyzeFile(file) // Same here
            ]);
            
            document.getElementById('sha1Value').textContent = hashes['SHA-1'];
            document.getElementById('sha256Value').textContent = hashes['SHA-256'];
            document.getElementById('sha384Value').textContent = hashes['SHA-384'];
            document.getElementById('sha512Value').textContent = hashes['SHA-512'];
            
            document.getElementById('metaFileName').textContent = metadata.name;
            document.getElementById('metaFileSize').textContent = metadata.sizeFormatted;
            document.getElementById('metaFileType').textContent = metadata.type;
            document.getElementById('metaFileExtension').textContent = metadata.extension;
            document.getElementById('metaLastModified').textContent = metadata.lastModified.toLocaleString();
            
            const imageMetadataDiv = document.getElementById('imageMetadata');
            if (metadata.image) {
              document.getElementById('imageDimensions').textContent = `${metadata.image.width} × ${metadata.image.height} pixels`;
              document.getElementById('imageAspectRatio').textContent = metadata.image.aspectRatio;
              imageMetadataDiv.style.display = 'block';
            } else {
              imageMetadataDiv.style.display = 'none';
            }
            
            populateEnhancedMetadata(metadata);
            populateAdvancedAnalysis(advancedResults);

            // New: Byte Pattern Analysis
            if (currentFileUint8Array) { // Check if currentFileUint8Array was populated
                // Calculate and display byte frequencies
                const frequencies = window.BytePatternAnalyzerLogic.calculateByteFrequencies(currentFileUint8Array);
                window.BytePatternAnalyzerLogic.displayByteFrequencyChart(frequencies, 'byteFrequencyChartCanvas');

                // Calculate and display Shannon Entropy
                const totalBytesForEntropy = currentFileUint8Array.length;
                const entropy = window.BytePatternAnalyzerLogic.calculateShannonEntropy(frequencies, totalBytesForEntropy);
                const entropyDisplayEl = document.getElementById('entropyDisplay');
                if (entropyDisplayEl) {
                    entropyDisplayEl.textContent = `Entropy: ${entropy.toFixed(3)} bits/byte`;
                }
                // The interpretation text is static HTML, so no need to update it here unless dynamic levels are needed.

                // Calculate and display N-grams for default N
                const defaultNgramN = parseInt(document.getElementById('ngramNValue').value, 10) || 2;
                const ngrams = window.BytePatternAnalyzerLogic.calculateNGrams(currentFileUint8Array, defaultNgramN);
                window.BytePatternAnalyzerLogic.displayNGramTable(ngrams, 'ngramResultsTableContainer');

                // Show the pattern analysis card
                document.getElementById('bytePatternAnalysisCard').style.display = 'block';
            }
            
            resultDiv.style.display = 'block';
          } catch (error) {
            alert('Error processing file: ' + error.message);
            console.error("Processing error:", error); // Log error for details
            currentFileUint8Array = null; // Reset on error
            document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide on error
          } finally {
            loadingDiv.style.display = 'none';
            calculateBtn.disabled = false;
          }
        });
        
        // Event listener for N-gram analysis button
        document.getElementById('analyzeNGramsBtn').addEventListener('click', function() {
            if (!currentFileUint8Array) {
                alert('Please analyze a file first.');
                return;
            }
            const nValue = parseInt(document.getElementById('ngramNValue').value, 10);
            if (isNaN(nValue) || nValue < 1 || nValue > 5) {
                alert('Please enter a valid N value (1-5).');
                return;
            }
            const ngrams = window.BytePatternAnalyzerLogic.calculateNGrams(currentFileUint8Array, nValue);
            window.BytePatternAnalyzerLogic.displayNGramTable(ngrams, 'ngramResultsTableContainer');
        });

        // File Carving Button Event Listener
        document.getElementById('fileCarvingBtn').addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          this.disabled = true;
          calculateBtn.disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';
          document.getElementById('bytePatternAnalysisCard').style.display = 'none'; // Hide during carving


          try {
            loadingDiv.querySelector('p').textContent = 'Performing advanced file carving and embedded object extraction...';
            
            const carvingResults = await fileCarvingEngine.analyzeFile(file);
            
            let carvingContainer = document.getElementById('fileCarvingResults');
            if (!carvingContainer) {
              carvingContainer = document.createElement('div');
              carvingContainer.id = 'fileCarvingResults';
              resultDiv.parentNode.insertBefore(carvingContainer, resultDiv.nextSibling);
            }
            
            fileCarvingUI.renderCarvingResults(carvingResults, carvingContainer);
            carvingContainer.style.display = 'block';
            
          } catch (error) {
            alert('File carving failed: ' + error.message);
            console.error('File carving error:', error);
          } finally {
            loadingDiv.style.display = 'none';
            this.disabled = false;
            calculateBtn.disabled = false;
            loadingDiv.querySelector('p').textContent = 'Performing forensic analysis and extracting metadata...';
          }
        });

        // Visual File Map Button Event Listener
        document.getElementById('visualFileMapBtn').addEventListener('click', async function() {
          const file = fileInput.files[0];
          if (!file) return;

          this.disabled = true;
          calculateBtn.disabled = true;
          document.getElementById('fileCarvingBtn').disabled = true;
          loadingDiv.style.display = 'block';
          resultDiv.style.display = 'none';

          try {
            loadingDiv.querySelector('p').textContent = 'Creating interactive visual file structure map...';
            
            const visualMap = new VisualFileMap();
            const structure = await visualMap.analyzeFileStructure(file);
            
            // Create or update visualization container
            let visualContainer = document.getElementById('visualFileMapContainer');
            if (!visualContainer) {
              visualContainer = document.createElement('div');
              visualContainer.id = 'visualFileMapContainer';
              visualContainer.className = 'mt-4';
              visualContainer.innerHTML = `
                <div class="card">
                  <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                      <i class="fas fa-project-diagram mr-2"></i>Interactive Visual File Structure Map
                    </h5>
                  </div>
                  <div class="card-body" id="visualMapCanvas">
                    <!-- Canvas will be inserted here -->
                  </div>
                </div>
              `;
              resultDiv.parentNode.insertBefore(visualContainer, resultDiv.nextSibling);
            }
            
            // Create visualization
            const canvasContainer = document.getElementById('visualMapCanvas');
            visualMap.createVisualization(structure, canvasContainer);
            
            visualContainer.style.display = 'block';
            
            // Show example of the space-to-newline function
            const exampleText = "This is a test string with spaces";
            const convertedText = visualMap.replaceSpacesWithNewlines(exampleText);
            console.log("Space to newline conversion example:");
            console.log("Original:", exampleText);
            console.log("Converted:", convertedText);
            
          } catch (error) {
            alert('Visual file map creation failed: ' + error.message);
            console.error('Visual file map error:', error);
          } finally {
            loadingDiv.style.display = 'none';
            this.disabled = false;
            calculateBtn.disabled = false;
            document.getElementById('fileCarvingBtn').disabled = false;
            loadingDiv.querySelector('p').textContent = 'Performing forensic analysis and extracting metadata...';
          }
        });
        
        function populateAdvancedAnalysis(advanced) {
          // Clear previous advanced data
          const advancedContainer = document.getElementById('advancedAnalysis');
          if (advancedContainer) {
            advancedContainer.remove();
          }
          
          // Create advanced analysis container
          const container = document.createElement('div');
          container.id = 'advancedAnalysis';
          container.className = 'mt-4';
          
          let advancedHTML = '<h3 class="text-center mb-4"><i class="fas fa-microscope mr-2"></i>Advanced Forensic Analysis</h3>';
          
          // Interactive Hex Viewer
          if (advanced.hexViewer) {
            advancedHTML += createHexViewer(advanced.hexViewer);
          }
          
          // Entropy Visualization
          if (advanced.entropyViz) {
            advancedHTML += createEntropyVisualization(advanced.entropyViz);
          }
          
          // String Extraction
          if (advanced.strings) {
            advancedHTML += createStringAnalysis(advanced.strings);
          }
          
          // Binary Pattern Analysis
          if (advanced.binaryPatterns) {
            advancedHTML += createBinaryPatternAnalysis(advanced.binaryPatterns);
          }
          
          // Cryptographic Analysis
          if (advanced.cryptoAnalysis) {
            advancedHTML += createCryptoAnalysis(advanced.cryptoAnalysis);
          }
          
          // Image-specific advanced features
          if (advanced.qrCodes) {
            advancedHTML += createQRCodeAnalysis(advanced.qrCodes);
          }
          
          if (advanced.steganography) {
            advancedHTML += createSteganographyAnalysis(advanced.steganography);
          }
          
          if (advanced.imageForensics) {
            advancedHTML += createImageForensics(advanced.imageForensics);
          }
          
          if (advanced.geoLocation && advanced.geoLocation.hasGPS) {
            advancedHTML += createGeoLocationAnalysis(advanced.geoLocation);
          }
          
          // Audio analysis
          if (advanced.spectralAnalysis) {
            advancedHTML += createSpectralAnalysis(advanced.spectralAnalysis);
          }
          
          container.innerHTML = advancedHTML;
          resultDiv.appendChild(container);
        }
        
        function createHexViewer(hexData) {
          let html = `
            <div class="card mb-3">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                  <i class="fas fa-code mr-2"></i>Interactive Hex Viewer
                  <span class="badge badge-light ml-2">${hexData.totalBytes.toLocaleString()} bytes</span>
                </h5>
              </div>
              <div class="card-body p-0">
                <div class="hex-viewer" style="font-family: 'Courier New', monospace; font-size: 12px; background: #000; color: #0f0; padding: 15px; max-height: 400px; overflow-y: auto;">
          `;
          
          hexData.hexRows.forEach(row => {
            html += `
              <div class="hex-row" style="margin-bottom: 2px;">
                <span style="color: #888; margin-right: 15px;">${row.offset}</span>
                <span style="margin-right: 15px;">${row.hex}</span>
                <span style="color: #ff0; background: rgba(255,255,0,0.1); padding: 0 5px;">${row.ascii}</span>
              </div>
            `;
          });
          
          if (hexData.hasMore) {
            html += '<div class="text-center" style="color: #888; margin-top: 10px;">... (showing first 2KB)</div>';
          }
          
          html += `
                </div>
              </div>
            </div>
          `;
          
          return html;
        }
        
        function createEntropyVisualization(entropyData) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-chart-area mr-2"></i>Entropy Visualization
                  <span class="badge badge-light ml-2">${entropyData.data.length} blocks</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="text-center mb-3">
                  <img src="${entropyData.visualization}" alt="Entropy Graph" class="img-fluid" style="max-width: 100%; border: 1px solid #ddd;">
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>High Entropy Regions:</strong> ${entropyData.analysis.highEntropyPercentage}%</p>
                    <p><strong>Low Entropy Regions:</strong> ${entropyData.analysis.lowEntropyPercentage}%</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong>Suspicious Regions:</strong> ${entropyData.analysis.suspiciousRegions.length}</p>
                    <p><strong>Structured Regions:</strong> ${entropyData.analysis.structuredRegions.length}</p>
                  </div>
                </div>
                <div class="mt-2">
                  <small class="text-muted">
                    <span style="color: #0066cc;">█</span> Low entropy (structured) 
                    <span style="color: #ffaa00;">█</span> Medium entropy 
                    <span style="color: #ff6600;">█</span> High entropy 
                    <span style="color: #ff0000;">█</span> Very high (encrypted/random)
                  </small>
                </div>
              </div>
            </div>
          `;
        }
        
        function createStringAnalysis(stringData) {
          let html = `
            <div class="card mb-3">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="fas fa-search mr-2"></i>String Extraction
                  <span class="badge badge-light ml-2">${stringData.total} strings found</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="row mb-3">
          `;
          
          for (const [category, count] of Object.entries(stringData.categories)) {
            html += `<div class="col-md-4"><span class="badge badge-info">${category}</span> ${count}</div>`;
          }
          
          html += `
                </div>
                <div style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;">
          `;
          
          const displayStrings = stringData.strings.slice(0, 20);
          displayStrings.forEach(str => {
            const colorClass = getStringTypeColor(str.type);
            html += `
              <div class="string-item mb-2" style="border-left: 3px solid ${colorClass}; padding-left: 8px;">
                <span class="badge badge-secondary" style="font-size: 10px;">0x${str.offset.toString(16).toUpperCase()}</span>
                <span class="badge badge-primary">${str.type}</span>
                <code style="font-size: 11px;">${escapeHtml(str.content.substring(0, 80))}${str.content.length > 80 ? '...' : ''}</code>
              </div>
            `;
          });
          
          if (stringData.strings.length > 20) {
            html += `<div class="text-center"><em>... and ${stringData.strings.length - 20} more strings</em></div>`;
          }
          
          html += `
                </div>
              </div>
            </div>
          `;
          
          return html;
        }
        
        function createBinaryPatternAnalysis(patterns) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-chart-pie mr-2"></i>Binary Pattern Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>Null Bytes:</strong> ${patterns.nullBytes.toLocaleString()}</p>
                    <p><strong>Repeating Bytes:</strong> ${patterns.repeatingBytes.toLocaleString()}</p>
                    <p><strong>Sequential Bytes:</strong> ${patterns.sequentialBytes.toLocaleString()}</p>
                    <p><strong>Randomness Score:</strong> ${patterns.randomness}%</p>
                  </div>
                  <div class="col-md-6">
                    <div class="alert alert-light">
                      <strong>Analysis:</strong>
                      <ul class="mb-0 mt-2">
                        ${patterns.analysis.map(item => `<li>${item}</li>`).join('')}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        
        function createCryptoAnalysis(crypto) {
          const alertClass = crypto.possibleEncryption ? 'alert-warning' : 'alert-success';
          return `
            <div class="card mb-3">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-shield-alt mr-2"></i>Cryptographic Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="alert ${alertClass}">
                  <strong>Encryption Detected:</strong> ${crypto.possibleEncryption ? '⚠️ POSSIBLE' : '✅ UNLIKELY'}
                  <br><strong>Entropy Score:</strong> ${crypto.entropy.toFixed(3)}/8.0
                </div>
                ${crypto.keySchedulePatterns.length > 0 ? `
                  <div class="mt-3">
                    <strong>Key Schedule Patterns:</strong>
                    <ul>${crypto.keySchedulePatterns.map(pattern => `<li>${pattern}</li>`).join('')}</ul>
                  </div>
                ` : ''}
                ${crypto.blockCipherIndicators.length > 0 ? `
                  <div class="mt-3">
                    <strong>Block Cipher Indicators:</strong>
                    <ul>${crypto.blockCipherIndicators.map(indicator => `<li>${indicator}</li>`).join('')}</ul>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        }
        
        function createQRCodeAnalysis(qrData) {
          if (qrData.error) {
            return `
              <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0"><i class="fas fa-qrcode mr-2"></i>QR Code Analysis</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">${qrData.error}</p>
                </div>
              </div>
            `;
          }
          
          return `
            <div class="card mb-3">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-qrcode mr-2"></i>QR Code / Barcode Analysis
                </h5>
              </div>
              <div class="card-body">
                <p><strong>QR Code Detected:</strong> ${qrData.hasQRCode ? '✅ YES' : '❌ NO'}</p>
                <p><strong>Positioning Patterns:</strong> ${qrData.positioningPatterns}</p>
                <p><strong>Detection Confidence:</strong> <span class="badge badge-${qrData.confidence === 'High' ? 'success' : 'warning'}">${qrData.confidence}</span></p>
                <small class="text-muted">${qrData.note}</small>
              </div>
            </div>
          `;
        }
        
        function createSteganographyAnalysis(stegoData) {
          if (stegoData.error) {
            return `
              <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0"><i class="fas fa-eye-slash mr-2"></i>Steganography Analysis</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">${stegoData.error}</p>
                </div>
              </div>
            `;
          }
          
          const alertClass = stegoData.suspicionLevel === 'High' ? 'alert-danger' : 
                           stegoData.suspicionLevel === 'Medium' ? 'alert-warning' : 'alert-success';
          
          return `
            <div class="card mb-3">
              <div class="card-header bg-purple text-white" style="background-color: #6f42c1 !important;">
                <h5 class="mb-0">
                  <i class="fas fa-eye-slash mr-2"></i>Steganography Detection
                </h5>
              </div>
              <div class="card-body">
                <div class="alert ${alertClass}">
                  <strong>Suspicion Level:</strong> ${stegoData.suspicionLevel}
                  <br><strong>LSB Change Ratio:</strong> ${stegoData.lsbChangeRatio}
                </div>
                <p><strong>Analysis:</strong> ${stegoData.analysis}</p>
                <p><strong>Recommendation:</strong> ${stegoData.recommendation}</p>
              </div>
            </div>
          `;
        }
        
        function createImageForensics(forensics) {
          if (!forensics.applicable) {
            return `
              <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0"><i class="fas fa-search-plus mr-2"></i>Image Forensics (ELA)</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">${forensics.reason}</p>
                </div>
              </div>
            `;
          }
          
          if (forensics.error) {
            return `
              <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0"><i class="fas fa-search-plus mr-2"></i>Image Forensics (ELA)</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">${forensics.error}</p>
                </div>
              </div>
            `;
          }
          
          const alertClass = forensics.manipulationSuspicion === 'High' ? 'alert-danger' : 
                           forensics.manipulationSuspicion === 'Medium' ? 'alert-warning' : 'alert-success';
          
          return `
            <div class="card mb-3">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-search-plus mr-2"></i>JPEG Error Level Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="alert ${alertClass}">
                  <strong>Manipulation Suspicion:</strong> ${forensics.manipulationSuspicion}
                  <br><strong>Average Error Level:</strong> ${forensics.averageErrorLevel}
                  <br><strong>Maximum Error Level:</strong> ${forensics.maximumErrorLevel}
                </div>
                <p><strong>Analysis:</strong> ${forensics.analysis}</p>
              </div>
            </div>
          `;
        }
        
        function createGeoLocationAnalysis(geoData) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="fas fa-map-marker-alt mr-2"></i>Geographic Location
                </h5>
              </div>
              <div class="card-body">
                <p><strong>GPS Coordinates:</strong> ${geoData.locationString}</p>
                <p><strong>Latitude:</strong> ${geoData.latitude}</p>
                <p><strong>Longitude:</strong> ${geoData.longitude}</p>
                <a href="${geoData.mapUrl}" target="_blank" class="btn btn-primary btn-sm">
                  <i class="fas fa-external-link-alt mr-1"></i>View on Google Maps
                </a>
              </div>
            </div>
          `;
        }
        
        function createSpectralAnalysis(spectralData) {
          if (spectralData.error) {
            return `
              <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0"><i class="fas fa-wave-square mr-2"></i>Spectral Analysis</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">${spectralData.error}</p>
                </div>
              </div>
            `;
          }
          
          return `
            <div class="card mb-3">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-wave-square mr-2"></i>Audio Spectral Analysis
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>Sample Rate:</strong> ${spectralData.sampleRate} Hz</p>
                    <p><strong>Duration:</strong> ${spectralData.duration} seconds</p>
                    <p><strong>Total Samples:</strong> ${spectralData.samples.toLocaleString()}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong>Low Frequencies:</strong> ${spectralData.frequencyDistribution.low}</p>
                    <p><strong>Mid Frequencies:</strong> ${spectralData.frequencyDistribution.mid}</p>
                    <p><strong>High Frequencies:</strong> ${spectralData.frequencyDistribution.high}</p>
                  </div>
                </div>
                <p class="mt-3"><strong>Analysis:</strong> ${spectralData.analysis}</p>
              </div>
            </div>
          `;
        }
        
        function getStringTypeColor(type) {
          const colors = {
            'URL': '#007bff',
            'Email': '#28a745',
            'IP Address': '#dc3545',
            'File Path': '#fd7e14',
            'Registry Key': '#6610f2',
            'UUID': '#e83e8c',
            'Base64': '#20c997',
            'Hex String': '#6f42c1',
            'Text': '#6c757d'
          };
          return colors[type] || '#6c757d';
        }
        
        function escapeHtml(text) {
          const div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
        }
        
        function populateEnhancedMetadata(metadata) {
          const enhancedContainer = document.getElementById('enhancedMetadata');
          if (enhancedContainer) {
            enhancedContainer.remove();
          }
          
          const container = document.createElement('div');
          container.id = 'enhancedMetadata';
          container.className = 'mt-3';
          
          let enhancedHTML = '';
          
          if (metadata.signature) {
            enhancedHTML += createMetadataCard('File Signature Analysis', 'fas fa-fingerprint', 'warning', [
              `<strong>Detected Type:</strong> ${metadata.signature.detectedType}`,
              `<strong>File Signature:</strong> <code>${metadata.signature.signature}</code>`,
              `<strong>Matches Extension:</strong> ${metadata.signature.matchesExtension ? '✅ Yes' : '❌ No'}`,
              `<strong>Confidence:</strong> ${metadata.signature.confidence.toUpperCase()}`
            ]);
          }
          
          if (metadata.binary) {
            enhancedHTML += createMetadataCard('Binary Analysis', 'fas fa-chart-bar', 'info', [
              `<strong>Entropy:</strong> ${metadata.binary.entropy} (${metadata.binary.entropyAnalysis})`,
              `<strong>Randomness Score:</strong> ${metadata.binary.randomnessScore}`,
              `<strong>Is Binary:</strong> ${metadata.binary.isBinary ? '✅ Yes' : '❌ No'}`,
              `<strong>Has Null Bytes:</strong> ${metadata.binary.hasNullBytes ? '✅ Yes' : '❌ No'}`,
              `<strong>Compression:</strong> ${metadata.binary.compressionRatio}`
            ]);
          }
          
          if (metadata.image && (metadata.image.exif || metadata.image.colors || metadata.image.technical)) {
            let imageDetails = [];
            if (metadata.image.exif) {
              imageDetails.push(`<strong>EXIF Data:</strong> ${metadata.image.exif.hasEXIF ? '✅ Present' : '❌ Not found'}`);
              if (metadata.image.exif.hasGPS) {
                imageDetails.push(`<strong>GPS Data:</strong> ✅ Contains location information`);
              }
              if (metadata.image.exif.exifLength) {
                imageDetails.push(`<strong>EXIF Size:</strong> ${metadata.image.exif.exifLength} bytes`);
              }
            }
            if (metadata.image.colors) {
              imageDetails.push(`<strong>Unique Colors:</strong> ${metadata.image.colors.uniqueColors.toLocaleString()}`);
              imageDetails.push(`<strong>Total Pixels:</strong> ${metadata.image.colors.totalPixels.toLocaleString()}`);
              if (metadata.image.colors.dominantColors && metadata.image.colors.dominantColors.length > 0) {
                const colorPalette = metadata.image.colors.dominantColors
                  .map(color => `<span style="display:inline-block;width:20px;height:20px;background:${color.color};border:1px solid #ccc;margin-right:5px;vertical-align:middle;"></span>${color.color}`)
                  .join('<br>');
                imageDetails.push(`<strong>Color Palette:</strong><br>${colorPalette}`);
              }
            }
            if (metadata.image.technical) {
              imageDetails.push(`<strong>Compression Ratio:</strong> ${metadata.image.technical.compressionRatio}`);
              if (metadata.image.technical.hasTransparency !== undefined) {
                imageDetails.push(`<strong>Has Transparency:</strong> ${metadata.image.technical.hasTransparency ? '✅ Yes' : '❌ No'}`);
              }
              if (metadata.image.technical.isAnimated !== undefined) {
                imageDetails.push(`<strong>Is Animated:</strong> ${metadata.image.technical.isAnimated ? '✅ Yes' : '❌ No'}`);
              }
            }
            enhancedHTML += createMetadataCard('Enhanced Image Analysis', 'fas fa-image', 'success', imageDetails);
          }
          
          if (metadata.text) {
            enhancedHTML += createMetadataCard('Text File Analysis', 'fas fa-file-alt', 'primary', [
              `<strong>Lines:</strong> ${metadata.text.lineCount.toLocaleString()}`,
              `<strong>Words:</strong> ${metadata.text.wordCount.toLocaleString()}`,
              `<strong>Characters:</strong> ${metadata.text.characterCount.toLocaleString()} (${metadata.text.characterCountNoSpaces.toLocaleString()} without spaces)`,
              `<strong>Average Line Length:</strong> ${metadata.text.averageLineLength.toFixed(1)} characters`,
              `<strong>Language:</strong> ${metadata.text.language}`,
              `<strong>Encoding:</strong> ${metadata.text.encoding}`,
              `<strong>Line Endings:</strong> ${metadata.text.lineEndings}`,
              `<strong>Contains Unicode:</strong> ${metadata.text.hasUnicode ? '✅ Yes' : '❌ No'}`,
              `<strong>Is Empty:</strong> ${metadata.text.isEmpty ? '✅ Yes' : '❌ No'}`
            ]);
          }
          
          if (metadata.media) {
            let mediaDetails = [`<strong>Duration:</strong> ${metadata.media.durationFormatted || 'Unknown'}`];
            if (metadata.media.width && metadata.media.height) {
              mediaDetails.push(`<strong>Resolution:</strong> ${metadata.media.width} × ${metadata.media.height}`);
              mediaDetails.push(`<strong>Aspect Ratio:</strong> ${metadata.media.aspectRatio}`);
            }
            if (metadata.media.audioDecodedBytes) {
              mediaDetails.push(`<strong>Audio Data:</strong> ${(metadata.media.audioDecodedBytes / 1024).toFixed(1)} KB`);
            }
            if (metadata.media.error) {
              mediaDetails.push(`<strong>Error:</strong> ${metadata.media.error}`);
            }
            enhancedHTML += createMetadataCard('Media File Analysis', 'fas fa-play-circle', 'info', mediaDetails);
          }
          
          if (metadata.web) {
            let webDetails = [];
            if (metadata.web.title) { webDetails.push(`<strong>Title:</strong> ${metadata.web.title}`);}
            if (metadata.web.tagCount !== undefined) {
              webDetails.push(`<strong>HTML Tags:</strong> ${metadata.web.tagCount} (${metadata.web.uniqueTags} unique)`);
              webDetails.push(`<strong>Links:</strong> ${metadata.web.links || 0}`);
              webDetails.push(`<strong>Images:</strong> ${metadata.web.images || 0}`);
              webDetails.push(`<strong>Scripts:</strong> ${metadata.web.scripts || 0}`);
              webDetails.push(`<strong>Has DOCTYPE:</strong> ${metadata.web.hasDoctype ? '✅ Yes' : '❌ No'}`);
            }
            if (metadata.web.ruleCount !== undefined) {
              webDetails.push(`<strong>CSS Rules:</strong> ${metadata.web.ruleCount}`);
              webDetails.push(`<strong>Selectors:</strong> ${metadata.web.selectorCount}`);
              webDetails.push(`<strong>Properties:</strong> ${metadata.web.propertyCount}`);
              webDetails.push(`<strong>Has Media Queries:</strong> ${metadata.web.hasMediaQueries ? '✅ Yes' : '❌ No'}`);
              webDetails.push(`<strong>Is Minified:</strong> ${metadata.web.isMinified ? '✅ Yes' : '❌ No'}`);
            }
            if (metadata.web.functionCount !== undefined) {
              webDetails.push(`<strong>Functions:</strong> ${metadata.web.functionCount}`);
              webDetails.push(`<strong>Variables:</strong> ${metadata.web.variableDeclarations}`);
              webDetails.push(`<strong>Has Modules:</strong> ${metadata.web.hasModules ? '✅ Yes' : '❌ No'}`);
              webDetails.push(`<strong>Has Async/Await:</strong> ${metadata.web.hasAsyncAwait ? '✅ Yes' : '❌ No'}`);
              webDetails.push(`<strong>Complexity Score:</strong> ${metadata.web.complexity}`);
            }
            if (webDetails.length > 0) {
              enhancedHTML += createMetadataCard('Web File Analysis', 'fas fa-code', 'secondary', webDetails);
            }
          }
          
          if (metadata.analysis) {
            enhancedHTML += createMetadataCard('Analysis Performance', 'fas fa-tachometer-alt', 'dark', [
              `<strong>Processing Time:</strong> ${metadata.analysis.processingTime.toFixed(2)} ms`,
              `<strong>Analysis Confidence:</strong> ${metadata.analysis.confidence.toUpperCase()}`,
              metadata.analysis.error ? `<strong>Errors:</strong> ${metadata.analysis.error}` : ''
            ].filter(item => item));
          }
          
          container.innerHTML = enhancedHTML;
          const hashCard = resultDiv.querySelector('.card:last-child'); // This might need adjustment if Byte Pattern card is already there
          hashCard.parentNode.insertBefore(container, hashCard.nextSibling);
        }
        
        function createMetadataCard(title, icon, colorClass, items) {
          return `
            <div class="card mb-3">
              <div class="card-header bg-${colorClass} text-white">
                <h5 class="mb-0">
                  <i class="${icon} mr-2"></i>${title}
                </h5>
              </div>
              <div class="card-body">
                ${items.map(item => `<p class="mb-2">${item}</p>`).join('')}
              </div>
            </div>
          `;
        }
      });
      
      function copyToClipboard(elementId, button) {
        const element = document.getElementById(elementId);
        const text = element.textContent;
        
        navigator.clipboard.writeText(text).then(function() {
          const originalHTML = button.innerHTML;
          button.innerHTML = '<i class="fas fa-check"></i> Copied!';
          button.classList.remove('btn-outline-primary');
          button.classList.add('btn-success');
          
          setTimeout(function() {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-primary');
          }, 2000);
        }).catch(function(err) {
          console.error('Failed to copy text: ', err);
          alert('Failed to copy to clipboard');
        });
      }
      
      // Joke Generator Functionality
      let currentJokeTopic = '';
      
      document.getElementById('jokeForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const topic = document.getElementById('jokeTopic').value.trim();
        if (!topic) return;
        
        currentJokeTopic = topic;
        await fetchJoke(topic);
      });
      
      async function fetchJoke(topic) {
        const loadingDiv = document.getElementById('jokeLoading');
        const resultDiv = document.getElementById('jokeResult');
        const jokeContent = document.getElementById('jokeContent');
        const getJokeBtn = document.getElementById('getJokeBtn');
        
        // Show loading state
        loadingDiv.style.display = 'block';
        resultDiv.style.display = 'none';
        getJokeBtn.disabled = true;
        
        try {
          const response = await fetch(`/joke?topic=${encodeURIComponent(topic)}`);
          
          if (!response.ok) {
            throw new Error('Failed to fetch joke');
          }
          
          const jokeText = await response.text();
          
          // Display the joke
          jokeContent.textContent = jokeText;
          resultDiv.style.display = 'block';
          
        } catch (error) {
          console.error('Error fetching joke:', error);
          jokeContent.innerHTML = `
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle mr-2"></i>
              Oops! Our comedian seems to have stage fright. Please try again!
            </div>
          `;
          resultDiv.style.display = 'block';
        } finally {
          loadingDiv.style.display = 'none';
          getJokeBtn.disabled = false;
        }
      }
      
      function getAnotherJoke() {
        if (currentJokeTopic) {
          fetchJoke(currentJokeTopic);
        }
      }
      
      function copyJoke() {
        const jokeText = document.getElementById('jokeContent').textContent;
        
        navigator.clipboard.writeText(jokeText).then(function() {
          // Find the copy button
          const copyBtn = event.target.closest('button');
          const originalHTML = copyBtn.innerHTML;
          
          copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
          copyBtn.classList.remove('btn-outline-success');
          copyBtn.classList.add('btn-success');
          
          setTimeout(function() {
            copyBtn.innerHTML = originalHTML;
            copyBtn.classList.remove('btn-success');
            copyBtn.classList.add('btn-outline-success');
          }, 2000);
        }).catch(function(err) {
          console.error('Failed to copy joke:', err);
          alert('Failed to copy joke to clipboard');
        });
      }
      
      function shareJoke() {
        const jokeText = document.getElementById('jokeContent').textContent;
        const shareData = {
          title: 'Check out this joke!',
          text: jokeText + '\n\n',
          url: window.location.href
        };
        
        if (navigator.share) {
          navigator.share(shareData)
            .then(() => console.log('Joke shared successfully'))
            .catch((error) => console.log('Error sharing:', error));
        } else {
          // Fallback - copy to clipboard
          navigator.clipboard.writeText(jokeText + '\n\nShared from: ' + window.location.href)
            .then(() => {
              alert('Joke copied to clipboard! You can now paste it anywhere to share.');
            })
            .catch((err) => {
              console.error('Failed to copy:', err);
              alert('Unable to share. Please copy the joke manually.');
            });
        }
      }
    </script>
  </body>
</html>